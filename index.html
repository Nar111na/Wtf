<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rave Clone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { width: 100%; min-height: 100vh; font-family: sans-serif; color: white; background: #07030f; overflow-x: hidden; }
    .rave-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #0a0614; overflow: hidden; }
    .blob { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.5; will-change: transform; }
    .blob-1 { width: 70vmax; height: 70vmax; top: -20%; left: -20%; background: #4a1d7a; animation: drift 20s infinite alternate linear; }
    .blob-2 { width: 60vmax; height: 60vmax; bottom: -20%; right: -20%; background: #123597; animation: drift 25s infinite alternate-reverse linear; }
    .blob-3 { width: 50vmax; height: 50vmax; top: 20%; left: 10%; background: #b01a71; animation: drift 18s infinite alternate linear; }
    @keyframes drift { from { transform: translate(0,0) scale(1); } to { transform: translate(10vw, 10vh) scale(1.1); } }
    .wrapper { position: relative; z-index: 10; width: 100%; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 20px; }
    .logo { font-size: 32px; font-weight: 900; }
    .search-bar { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 14px; padding: 12px; margin: 0 15px 15px; display: flex; align-items: center; }
    .search-bar input { background: none; border: none; color: white; margin-left: 10px; width: 100%; outline: none; }
    .rooms-list { display: flex; flex-direction: column; gap: 12px; padding: 12px; }
    .card { background: rgba(255,255,255,0.07); backdrop-filter: blur(15px); border-radius: 20px; display: flex; height: 100px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
    .thumb { width: 140px; background: #000; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    .info { padding: 12px; display: flex; flex-direction: column; justify-content: space-between; }
    .fab { position: fixed; bottom: 30px; right: 25px; background: #fff; color: #000; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 100; }
  </style>
</head>
<body>
  <div class="rave-bg">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>
  <div class="wrapper">
    <header><i class="fas fa-cog"></i><div class="logo">rave</div><i class="fas fa-user-friends"></i></header>
    <div class="search-bar"><i class="fas fa-search"></i><input type="text" placeholder="Поиск"></div>
    <div id="rooms-container" class="rooms-list"></div>
  </div>
  <div class="fab" onclick="createRoom()"><i class="fas fa-plus"></i></div>
  <script>
    const S_URL = 'https://otkessnonmdttowgkfrg.supabase.co';
    const S_KEY = 'Sb_publishable_J3AE0I_VFL0dvf3ffO7vbg_bwHJSWux';
    const _supabase = supabase.createClient(S_URL, S_KEY);

    async function loadRooms() {
      const { data } = await _supabase.from('rooms').select('*').gt('participants_count', 0).order('created_at', { ascending: false });
      const list = document.getElementById('rooms-container');
      list.innerHTML = data ? data.map(r => `
        <div class="card">
          <div class="thumb"><img src="https://picsum.photos/seed/${r.id}/200/120"></div>
          <div class="info"><b>${r.title}</b><p style="font-size:12px;opacity:0.6">${r.participants_count} участников</p></div>
        </div>`).join('') : '';
    }

    async function createRoom() {
      const n = prompt("Название:");
      if (n) { await _supabase.from('rooms').insert([{ title: n, participants_count: 1 }]); loadRooms(); }
    }

    loadRooms();
    _supabase.channel('any').on('postgres_changes', {event:'*', schema:'public', table:'rooms'}, loadRooms).subscribe();
  </script>
</body>
</html>
